<html>
<head>

<style>
body { background: #111; color: #FC0; }
a { color: #FF0; }
a:visited { color: #A60; }

</style>

  <script type="text/JavaScript">
  // Set up a watcher process to reload the page on backnavigation.
  var hash = -1; // Weird initial value to guarantee initial page load.
  setInterval(function(){
      if (window.location.hash != hash) {
          hash = window.location.hash;
          loadPage();
      }
  }, 100);

  function httpGet(theUrl)
  {
    var request = new XMLHttpRequest();
    request.open("GET", theUrl, false);
    try {
        request.send(null);
        if (request.status == 404) { throw "Error"; }
        return request.responseText;
    } catch (e) {
        return "*** Not found ***";
    }
  }

  // http://stackoverflow.com/questions/5251520/how-do-i-escape-some-html-in-javascript
  function unhtml(inputText) {
      return inputText.replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
  }

  // http://stackoverflow.com/questions/37684/how-to-replace-plain-urls-with-links
  function linkify(inputText) {
      var replacedText, hyperlink, image, wikiword;

      hyperlink = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
      replacedText = inputText.replace(hyperlink, '<a href="$1">$1</a>');

      image = /^\s*(!\[([^\]]*)\]\(([^\)]+)\))\s*$/gm;
      replacedText = replacedText.replace(image, '<img alt="$2" src="$3" \>');

      // FIXME: Don't wikiWordify things put inside HTML tags by the
      // previous two steps.
      wikiword = /(\b[A-Z][a-z]+([A-Z][a-z]+|[0-9]+)+)\b/gm;
      replacedText = replacedText.replace(wikiword, '<a href="#$1">$1</a>');

      return replacedText;
  }

  function loadPage() {
      var text;
      if (window.location.hash) {
          text = httpGet(window.location.hash.substr(1));
      } else {
          text = httpGet("FrontPage");
      }

      text = unhtml(text);
      text = linkify(text);

      document.getElementById("payload").innerHTML = text;
  }
  </script>

</head>
<body>
  <pre id="payload">
  </pre>
</body>
</html>
